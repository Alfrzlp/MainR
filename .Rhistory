aes(
colour = col_text,
label = scales::percent(p, accuracy = 0.01)
),
position = position_stack(vjust = 0.5, reverse = F),
size = 3
) +
scale_colour_manual(values = c('black', 'white')) +
# scale_fill_brewer(palette = 'Greens') +
scale_fill_manual(
values = rev(my_col[1:3]),
labels = function(x) str_wrap(x, 20)
) +
scale_x_continuous(
breaks = seq(0, 1, by = 0.20),
labels = NULL,
expand = expansion(mult = c(0.005, 0.03))
) +
facet_grid(kab ~ ., scales = 'free_x', switch = 'y') +
labs(
x = NULL, y = NULL,
fill = NULL,
subtitle = 'Kabupaten Bandung Barat dan Kabupaten Purwakarta',
title = expression(bold('Persentase (%) Harga Jual Lahan (ribu per' ~ m^2 ~ ') Menurut Jenis Komoditas'))
) +
theme_minimal(base_line_size = 1) +
theme(
# legend.position = 'bottom',
legend.justification = "center",
strip.background = element_blank(),
strip.placement = "outside",
strip.text = element_text(size = 11.5, colour = 'gray30', face = 2),
axis.text.x = element_text(size = 10.5),
panel.grid.major = element_line(colour = 'gray', size = 0),
plot.subtitle = element_text(colour = 'gray30', face = 2),
legend.text = element_text(size = 9.5),
legend.spacing.y = unit(0.1, 'cm')
) +
guides(
colour = 'none',
fill = guide_legend(byrow = TRUE)
)
ggsave(
filename = 'E:/Visualisasi/riset/revisi terbaru/118_hargajuallahan.png',
width = 10.5,
height = 5,
units = "in",
dpi = 500,
scale = 0.8,
bg = 'white'
)
ggplot(data = gab) +
geom_sf(
aes(fill = Y2_nb), color = "white",
size = 0.3
) +
geom_sf(
data = batas_kab,
color = 'gray30',
fill = 'transparent',
size = 0.5,
inherit.aes = F
) +
geom_label_repel(
data = subset(gab, X_cen < 107.45),
aes(
label = str_wrap(nmkec, 15),
x = X_cen, y = Y_cen
),
xlim = c(107, Inf), ylim = c(-Inf, Inf),
min.segment.length = 0,
size = 2,
seed = 1,
hjust = 0,
box.padding = 0.17,
nudge_x = 107 - subset(gab, X_cen < 107.45)$X_cen,
inherit.aes = F,
max.overlaps = Inf,
max.iter = 1e4,
max.time = 1,
segment.size = 0.15,
segment.curvature = -1e-20, # biar sharp angle
segment.ncp = 3 # n control point
) +
geom_label_repel(
data = subset(gab, X_cen >= 107.45),
aes(
label = str_wrap(nmkec, 15),
x = X_cen, y = Y_cen
),
xlim = c(-Inf, 107.9), ylim = c(-Inf, Inf),
min.segment.length = 0,
size = 2,
seed = 1,
hjust = 1,
box.padding = 0.17,
nudge_x = 107 + subset(gab, X_cen >= 107.45)$X_cen,
inherit.aes = F,
max.overlaps = Inf,
max.iter = 1e5,
max.time = 1,
segment.angle = 90,
segment.size = 0.15,
segment.curvature = -1e-20, # biar sharp angle
segment.ncp = 3 # n control point
) +
geom_point(
aes(
x = X_cen, y = Y_cen
),
color = 'black',
inherit.aes = F,
size = 0.7
) +
scale_fill_manual(
values = rev(my_col)
) +
labs(
title = 'Peta Klasifikasi Laju Perubahan Lahan Sawah Tahunan',
subtitle = 'Kabupaten Bandung Barat dan Kabupaten Purwakarta Tahun 2013-2021',
fill = str_wrap('Kelas Laju Alih Fungsi Lahan Natural Break (%)', 25),
x = 'Longitude', y = 'Latitude'
) +
theme_bw() +
theme(
plot.title = element_text(face = 2),
plot.subtitle = element_text(colour = 'gray30')
) +
coord_sf(xlim = c(106.99, 107.9), ylim = c(-6.3, -7.2))
ggsave(
filename = "E:/Visualisasi/riset/Y2/y2_laju_rev.png",
width = 7,
height = 6.5,
units = "in",
dpi = 500,
scale = 1,
bg = "white"
)
# Indeks Moran ------------------------------------------------------------
w_gab <- poly2nb(gab)
ww_gab <- nb2listw(w_gab)
gab_moran1 <- moran(gab$Y1, ww_gab, n = length(ww_gab$neighbours), S0 = Szero(ww_gab))
gab_moran2 <- moran(gab$Y2, ww_gab, n = length(ww_gab$neighbours), S0 = Szero(ww_gab))
gab_moran3 <- moran(gab$Y3, ww_gab, n = length(ww_gab$neighbours), S0 = Szero(ww_gab))
dat <- data.frame(
x1 = scale(gab$Y1),
x2 = scale(gab$Y2),
x3 = scale(gab$Y3),
nmkec = str_to_title(gab$nmkec)
) %>%
mutate(
y1 = lag.listw(ww_gab, x1),
y2 = lag.listw(ww_gab, x2),
y3 = lag.listw(ww_gab, x3),
.before = nmkec
)
get_cluster <- function(x, y){
return(
case_when(
x < 0 & y < 0 ~ "Low-Low",
x < 0 & y > 0 ~ "Low-High",
x > 0 & y < 0 ~ "High-Low",
x > 0 & y > 0 ~ "High-High",
)
)
}
cluster_lvl <- c("High-High", "High-Low", "Low-High", "Low-Low")
dat <- dat %>%
mutate(
cluster1 = get_cluster(x1, y1),
cluster2 = get_cluster(x2, y2),
cluster3 = get_cluster(x3, y3),
across(starts_with('cluster'), ~ factor(.x, levels = cluster_lvl))
)
dat %>%
glimpse()
# Revisi Moran ------------------------------------------------------------
dat %>%
# ganti ini
ggplot(aes(x = x2, y = y2)) +
geom_point(aes(col = cluster2), size = 2.5) +
geom_vline(xintercept = 0, color = "gray60", lty = 5) +
geom_hline(yintercept = 0, color = "gray60", lty = 5) +
geom_smooth(method = "lm", se = F, color = "maroon") +
geom_text_repel(
# ganti ini
aes(color = cluster2, label = str_to_title(nmkec)),
size = 3,
min.segment.length = 0,
seed = 0,
max.time = 1,
max.iter = 1e5, # stop after 1 second, or after 100,000 iterations
box.padding = 0.4, # additional padding around each text label
max.overlaps = Inf,
direction = 'both',
segment.curvature = -1e-20,
segment.size = 0.15,
segment.ncp = 3,
) +
scale_color_manual(
values = c("red", "orange", "skyblue3", "navy")
) +
labs(
y = "Spatial Lag",
x = "Laju Alih Fungsi Lahan",
title = "Scatterplot Moran's I Y2",
subtitle = paste0("Moran's I: ", round(gab_moran2$I, 3))
) +
theme_bw(base_family = 'Arial') +
theme(
legend.position = "none",
plot.title = element_text(face = 2),
plot.subtitle = element_text(colour = 'gray30')
) +
xlim(c(-2, 2))
# Revisi Moran ------------------------------------------------------------
dat %>%
# ganti ini
ggplot(aes(x = x2, y = y2)) +
geom_point(aes(col = cluster2), size = 2.5) +
geom_vline(xintercept = 0, color = "gray60", lty = 5) +
geom_hline(yintercept = 0, color = "gray60", lty = 5) +
geom_smooth(method = "lm", se = F, color = "maroon") +
geom_text_repel(
# ganti ini
aes(color = cluster2, label = str_to_title(nmkec)),
size = 3,
min.segment.length = 0,
seed = 0,
max.time = 1,
max.iter = 1e5, # stop after 1 second, or after 100,000 iterations
box.padding = 0.4, # additional padding around each text label
max.overlaps = Inf,
direction = 'both',
segment.curvature = -1e-20,
segment.size = 0.15,
segment.ncp = 3,
) +
scale_color_manual(
values = c("red", "orange", "skyblue3", "navy")
) +
labs(
y = "Spatial Lag",
x = "Laju Alih Fungsi Lahan",
title = "Scatterplot Moran's I Laju Perubahan Lahan Sawah Tahunan",
subtitle = paste0("Moran's I: ", round(gab_moran2$I, 4))
) +
theme_bw(base_family = 'Arial') +
theme(
legend.position = "none",
plot.title = element_text(face = 2),
plot.subtitle = element_text(colour = 'gray30')
) +
xlim(c(-2, 2))
ggsave(
filename = "E:/Visualisasi/riset/Y2/y2_moran.png",
width = 7,
height = 6,
units = "in",
dpi = 500,
scale = 1,
bg = "white"
)
# Y1
ggplot(data = gab) +
geom_sf(
aes(fill = cluster2),
color = "white",
size = 0.15
) +
geom_sf(
data = batas_kab,
color = 'gray30',
fill = 'transparent',
size = 0.5,
inherit.aes = F
) +
geom_point(
data = ~.x %>%
dplyr::filter(!cluster2 %in% c('Not significant')),
aes(
x = X_cen, y = Y_cen
),
color = 'black',
inherit.aes = F,
size = 1
) +
geom_label_repel(
data = ~.x %>%
dplyr::filter(
!cluster2 %in% c('Not significant')
),
aes(
label = str_wrap(str_to_title(nmkec), 15),
x = X_cen, y = Y_cen
),
force = 0.5,
xlim = c(-Inf, Inf), ylim = c(-Inf, Inf),
min.segment.length = 0,
seed = 1,
direction = 'both',
box.padding = 0.9,
inherit.aes = F,
max.overlaps = Inf,
size = 3,
max.iter = 1e4,
max.time = 1,
segment.curvature = -1e-20,
segment.ncp = 5
) +
scale_fill_manual(
values = c('gray75', 'tomato', 'dodgerblue3', 'orange', 'steelblue', 'black', 'black'),
# values = c('gray', "red", 'navy', 'orange', 'skyblue3','black', 'black'),
labels = function(x) str_wrap(x, 10)
) +
labs(
title = "Peta Klaster Lisa Laju Perubahan Lahan Sawah Tahunan",
subtitle = 'Kabupaten Bandung Barat dan Kabupaten Purwakarta',
x = 'Longitude', y = 'Latitude', fill = 'cluster'
) +
theme_bw() +
theme(
plot.title = element_text(face = 2),
plot.subtitle = element_text(colour = 'gray30')
) +
coord_sf(xlim = c(107.1, 107.79), ylim = c(-6.35, -7.15))
# calculate LISA as per GEODA
lisaY1 <- local_moran(queen_w, gab["Y1"])
lisaY2 <- local_moran(queen_w, gab["Y2"])
lisaY3 <- local_moran(queen_w, gab["Y3"])
label <- lisaY1$GetLabels()
gab <- gab %>%
mutate(
cluster1 = factor(lisaY1$GetClusterIndicators(), levels = 0:6, labels = label),
cluster2 = factor(lisaY2$GetClusterIndicators(), levels = 0:6, labels = label),
cluster3 = factor(lisaY3$GetClusterIndicators(), levels = 0:6, labels = label)
)
gab
# LISA --------------------------------------------------------------------
queen_w <- queen_weights(gab)
# calculate LISA as per GEODA
lisaY1 <- local_moran(queen_w, gab["Y1"])
lisaY2 <- local_moran(queen_w, gab["Y2"])
lisaY3 <- local_moran(queen_w, gab["Y3"])
label <- lisaY1$GetLabels()
gab <- gab %>%
mutate(
cluster1 = factor(lisaY1$GetClusterIndicators(), levels = 0:6, labels = label),
cluster2 = factor(lisaY2$GetClusterIndicators(), levels = 0:6, labels = label),
cluster3 = factor(lisaY3$GetClusterIndicators(), levels = 0:6, labels = label)
)
gab
lisaY2$p_vals
# Y1
ggplot(data = gab) +
geom_sf(
aes(fill = cluster2),
color = "white",
size = 0.15
) +
geom_sf(
data = batas_kab,
color = 'gray30',
fill = 'transparent',
size = 0.5,
inherit.aes = F
) +
geom_point(
data = ~.x %>%
dplyr::filter(!cluster2 %in% c('Not significant')),
aes(
x = X_cen, y = Y_cen
),
color = 'black',
inherit.aes = F,
size = 1
) +
geom_label_repel(
data = ~.x %>%
dplyr::filter(
!cluster2 %in% c('Not significant')
),
aes(
label = str_wrap(str_to_title(nmkec), 15),
x = X_cen, y = Y_cen
),
force = 0.5,
xlim = c(-Inf, Inf), ylim = c(-Inf, Inf),
min.segment.length = 0,
seed = 1,
direction = 'both',
box.padding = 0.9,
inherit.aes = F,
max.overlaps = Inf,
size = 3,
max.iter = 1e4,
max.time = 1,
segment.curvature = -1e-20,
segment.ncp = 5
) +
scale_fill_manual(
values = c('gray75', 'tomato', 'dodgerblue3', 'orange', 'steelblue', 'black', 'black'),
# values = c('gray', "red", 'navy', 'orange', 'skyblue3','black', 'black'),
labels = function(x) str_wrap(x, 10)
) +
labs(
title = "Peta Klaster Lisa Laju Perubahan Lahan Sawah Tahunan",
subtitle = 'Kabupaten Bandung Barat dan Kabupaten Purwakarta',
x = 'Longitude', y = 'Latitude', fill = 'cluster'
) +
theme_bw() +
theme(
plot.title = element_text(face = 2),
plot.subtitle = element_text(colour = 'gray30')
) +
coord_sf(xlim = c(107.1, 107.79), ylim = c(-6.35, -7.15))
ggsave(
filename = "E:/Visualisasi/riset/Y2/y2_lisa.png",
width = 7,
height = 6.5,
units = "in",
dpi = 500,
scale = 1,
bg = "white"
)
ggplot(data = gab) +
geom_sf(
aes(fill = Y2_nb), color = "white",
size = 0.3
) +
geom_sf(
data = batas_kab,
color = 'gray30',
fill = 'transparent',
size = 0.5,
inherit.aes = F
) +
geom_label_repel(
data = subset(gab, X_cen < 107.45),
aes(
label = str_wrap(nmkec, 15),
x = X_cen, y = Y_cen
),
xlim = c(107, Inf), ylim = c(-Inf, Inf),
min.segment.length = 0,
size = 2,
seed = 1,
hjust = 0,
box.padding = 0.17,
nudge_x = 107 - subset(gab, X_cen < 107.45)$X_cen,
inherit.aes = F,
max.overlaps = Inf,
max.iter = 1e4,
max.time = 1,
segment.size = 0.15,
segment.curvature = -1e-20, # biar sharp angle
segment.ncp = 3 # n control point
) +
geom_label_repel(
data = subset(gab, X_cen >= 107.45),
aes(
label = str_wrap(nmkec, 15),
x = X_cen, y = Y_cen
),
xlim = c(-Inf, 107.9), ylim = c(-Inf, Inf),
min.segment.length = 0,
size = 2,
seed = 1,
hjust = 1,
box.padding = 0.17,
nudge_x = 107 + subset(gab, X_cen >= 107.45)$X_cen,
inherit.aes = F,
max.overlaps = Inf,
max.iter = 1e5,
max.time = 1,
segment.angle = 90,
segment.size = 0.15,
segment.curvature = -1e-20, # biar sharp angle
segment.ncp = 3 # n control point
) +
geom_point(
aes(
x = X_cen, y = Y_cen
),
color = 'black',
inherit.aes = F,
size = 0.7
) +
scale_fill_manual(
values = rev(my_col)
) +
labs(
title = 'Peta Klasifikasi Laju Perubahan Lahan Sawah Tahunan',
subtitle = 'Kabupaten Bandung Barat dan Kabupaten Purwakarta Tahun 2013-2021',
fill = str_wrap('Kelas Laju Perubahan Lahan Sawah Tahunan Natural Break (%)', 25),
x = 'Longitude', y = 'Latitude'
) +
theme_bw() +
theme(
plot.title = element_text(face = 2),
plot.subtitle = element_text(colour = 'gray30')
) +
coord_sf(xlim = c(106.99, 107.9), ylim = c(-6.3, -7.2))
ggsave(
filename = "E:/Visualisasi/riset/Y2/y2_laju_rev.png",
width = 7,
height = 6.5,
units = "in",
dpi = 500,
scale = 1,
bg = "white"
)
